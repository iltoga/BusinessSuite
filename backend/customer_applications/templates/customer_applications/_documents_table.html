{% load check_perms %}
<div class="table-responsive">
  <table class="table table-responsive-md align-middle" id="{% if show_merge_checkboxes %}merge-documents-table{% endif %}">
    <thead>
      <tr>
        {% if show_merge_checkboxes %}
        <th scope="col" class="text-center" style="width: 40px;" title="Order">#</th>
        <th scope="col" class="text-center" style="width: 50px;">
          <input type="checkbox" class="form-check-input select-all-docs" title="Select all" style="cursor: pointer; margin: 0;">
        </th>
        {% endif %}
        <th scope="col">Doc.Type</th>
        <th scope="col">Doc. Number</th>
        <th scope="col">Expiration Date</th>
        <th scope="col">Last Updated</th>
        <th scope="col">Completed</th>
        {% if user|has_perm:'customer_applications,document,change' and not docapplication.is_application_completed%}
        <th scope="col">Actions</th>
        {% endif %}
      </tr>
    </thead>
    <tbody>
      {% for document in documents %}
        {% if document.is_expired %}
          <tr class="table-danger{% if show_merge_checkboxes %} merge-doc-row{% endif %}" data-doc-id="{{ document.pk }}">
        {% else %}
          <tr class="{% if show_merge_checkboxes %}merge-doc-row{% endif %}" data-doc-id="{{ document.pk }}">
        {% endif %}

          {% if show_merge_checkboxes %}
          <td class="text-center drag-handle" style="cursor: grab;" title="Drag to reorder">
            <span class="merge-order-number text-muted">{{ forloop.counter }}</span>
            <i class="bi bi-grip-vertical text-secondary ms-1"></i>
          </td>
          <td class="text-center">
            {% if document.completed and document.file %}
            <input type="checkbox" class="form-check-input doc-merge-checkbox"
                   value="{{ document.pk }}"
                   data-doc-type="{{ document.doc_type.name }}"
                   style="cursor: pointer; margin: 0;">
            {% endif %}
          </td>
          {% endif %}

          <td>{{ document.doc_type }}</td>
          <!-- Document Number -->
          <td>{{ document.doc_number }}</td>
          <!-- Expiration Date -->
          <td>{{ document.expiration_date }}</td>

          <!-- Last Updated -->
          {% include "components/updated_at_by_table_col.html" with model=document %}

          <!-- Completed -->
          <td>
            {% if document.completed %}
              {% include "components/field_checked_true.html" with text="Yes" %}
            {% else %}
              {% include "components/field_checked_false.html" with text="No" %}
            {% endif %}
          </td>

          <!-- Actions -->
          <td>
            <div class="btn-group-sm" role="group">
            {% if user|has_perm:'customer_applications,document,change' %}
              {% if not docapplication.is_application_completed or upload_after_app_completed%}
                {% if btn_update_text %}
                  <a href="{% url 'customer-application-document-update' document.pk %}" class="btn btn-warning">{{ btn_update_text }}</a>
                {% else %}
                  <a href="{% url 'customer-application-document-update' document.pk %}" class="btn btn-warning">Upload</a>
                {% endif %}
              {% endif %}
            {% endif %}

            {% if user|has_perm:'customer_applications,document,view' %}
              <a href="{% url 'customer-application-document-detail' document.pk %}" class="btn btn-primary">View</a>
              <a href="{% url 'customer-application-document-detail-print' document.pk %}" target="_blank" class="btn btn-secondary">Print</a>
            {% endif %}
            </div>
          </td>

        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
