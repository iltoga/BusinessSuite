{% extends "base_template.html" %}
{% load static %}
{% load view_filters %}
{% load form_extras %}

{% block title %}BusinessSuite - Customer Details{% endblock %}

{% block content %}
  <div class="my-4">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h3>Customer ID #{{ customer.pk }}</h3>
      </div>
      <div class="card-body">
        <div class="row">
          {# Identity Column #}
          <div class="col-lg-6 mb-4 mb-lg-0">
            <h5 class="mb-3 border-bottom pb-2">Identity</h5>
            <p class="lead mb-2">
              {% if customer.title %}{{ customer.title }}. {% endif %}{{ customer.full_name }}
            </p>
            {% if customer.customer_type == 'company' and customer.company_name %}
              <div class="small text-muted mb-3">Company: {{ customer.company_name }}</div>
            {% endif %}
            <dl class="row mb-0">
              <dt class="col-5 col-sm-4">Customer Type</dt>
              <dd class="col-7 col-sm-8">{{ customer.get_customer_type_display }}</dd>
              {% if customer.nationality %}
              <dt class="col-5 col-sm-4">Nationality</dt>
              <dd class="col-7 col-sm-8">{{ customer.nationality }}</dd>
              {% endif %}
              {% if customer.birth_place %}
              <dt class="col-5 col-sm-4">Birth Place</dt>
              <dd class="col-7 col-sm-8">{{ customer.birth_place }}</dd>
              {% endif %}
              {% if customer.birthdate %}
              <dt class="col-5 col-sm-4">Birthdate</dt>
              <dd class="col-7 col-sm-8">{{ customer.birthdate }}</dd>
              {% endif %}
            </dl>
          </div>
          {# Contact & Payment Column #}
          <div class="col-lg-6">
            <h5 class="mb-3 border-bottom pb-2">Contact & Payment</h5>
            <dl class="row mb-3">
              <dt class="col-5 col-sm-4">Email</dt>
              <dd class="col-7 col-sm-8">{{ customer.email }}</dd>
              <dt class="col-5 col-sm-4">Telephone</dt>
              <dd class="col-7 col-sm-8">{{ customer.telephone }}</dd>
              <dt class="col-5 col-sm-4">Whatsapp</dt>
              <dd class="col-7 col-sm-8">{{ customer.whatsapp }}</dd>
              <dt class="col-5 col-sm-4">Telegram</dt>
              <dd class="col-7 col-sm-8">{{ customer.telegram }}</dd>
              {% if customer.npwp %}
              <dt class="col-5 col-sm-4">NPWP</dt>
              <dd class="col-7 col-sm-8">{{ customer.npwp }}</dd>
              {% endif %}
            </dl>
            <h6 class="mb-2 border-bottom pb-2">Address</h6>
            <div class="row mb-3">
              <div class="col-sm-6 mb-2 mb-sm-0">
                <strong>Address in Bali</strong>
                <div class="text-muted">{{ customer.address_bali|default:"—" }}</div>
              </div>
              <div class="col-sm-6">
                <strong>Address Abroad</strong>
                <div class="text-muted">{{ customer.address_abroad|default:"—" }}</div>
              </div>
            </div>
            <h6 class="mb-2 border-bottom pb-2">Notifications</h6>
            <dl class="row mb-0">
              <dt class="col-7 col-sm-6">Notify Expiration</dt>
              <dd class="col-5 col-sm-6">{{ customer.notify_documents_expiration|boolean_to_yes_no }}</dd>
              <dt class="col-7 col-sm-6">Notify By</dt>
              <dd class="col-5 col-sm-6">{{ customer.notify_by|default:"—" }}</dd>
              <dt class="col-7 col-sm-6">Notification Sent</dt>
              <dd class="col-5 col-sm-6">{{ customer.notification_sent|boolean_to_yes_no }}</dd>
            </dl>
          </div>
        </div>
      </div>
      <div class="card-body">
        <div class="card mt-3">
          <div class="card-header bg-secondary text-white">
            <h5 class="mb-0">Passport Details</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-4">
                {% if customer.passport_file %}
                  <a href="{{ customer.passport_file.url }}" target="_blank" rel="noopener noreferrer">
                    <img src="{{ customer.passport_file.url }}" alt="Passport Image" class="img-fluid img-thumbnail" style="max-height: 280px; width: auto;"/>
                  </a>
                  <div class="small text-muted mt-2">File: <a href="{{ customer.passport_file.url }}" target="_blank" rel="noopener noreferrer">{{ customer.passport_file.name|slice:'-40' }}</a></div>
                {% else %}
                  <div class="text-muted">No passport file uploaded.</div>
                {% endif %}
              </div>
              <div class="col-md-8">
                <table class="table mb-0">
                  <tbody>
                    {% if customer.passport_number %}
                    <tr><th scope="row" class="text-start">Passport Number</th><td class="text-start">{{ customer.passport_number }}</td></tr>
                    {% endif %}
                    {% if customer.passport_issue_date %}
                    <tr><th scope="row" class="text-start">Passport Issue Date</th><td class="text-start">{{ customer.passport_issue_date|date:"Y-m-d" }}</td></tr>
                    {% endif %}
                    {% if customer.passport_expiration_date %}
                    <tr><th scope="row" class="text-start">Passport Expiration Date</th><td class="text-start">{{ customer.passport_expiration_date|date:"Y-m-d" }}</td></tr>
                    {% endif %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        {% if perms.customers.change_customer %}
        <a href="{% url 'customer-update' customer.id %}" class="btn btn-warning">Edit</a>
        {% endif %}
        {% if perms.customers.delete_customer %}
        <a href="{% url 'customer-delete' customer.id %}" class="btn btn-danger">Delete</a>
        {% endif %}
        <a href="javascript:history.back()" class="btn btn-primary">Back</a>
      </div>
    </div>
  </div>
{% endblock %}
