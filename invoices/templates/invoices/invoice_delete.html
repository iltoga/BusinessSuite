{% extends "base_template.html" %}
{% block title %}BusinessSuite - Delete Invoice{% endblock %}

{% block content %}
<div class="container">
    <h2 class="text-center my-4">Delete Invoice</h2>

    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Invoice: {{ object.invoice_no_display }}</h5>
            <p class="card-text"><strong>Customer:</strong> {{ object.customer.full_name }}</p>
            <p class="card-text"><strong>Amount:</strong> {{ object.total_amount }}</p>
            <p class="card-text"><strong>Status:</strong> {{ object.get_status_display }}</p>

            {% if deletion_blocked %}
                <div class="alert alert-warning" role="alert">
                    <h5 class="alert-heading"><i class="bi bi-exclamation-triangle"></i> Deletion Blocked</h5>
                    <p>Invoices cannot be deleted to maintain data integrity.</p>
                    <hr>
                    <p class="mb-0">Only superusers have the ability to force delete invoices.</p>
                </div>

                <div class="mt-3">
                    <a href="{% url 'invoice-list' %}" class="btn btn-primary">Back to Invoice List</a>
                </div>
            {% else %}
                {% if is_superuser %}
                    <div class="alert alert-danger" role="alert">
                        <h5 class="alert-heading"><i class="bi bi-exclamation-triangle-fill"></i> Warning: Force Delete</h5>
                        <p><strong>You are about to permanently delete this invoice and all related data!</strong></p>

                        <h6 class="mt-3">The following will be CASCADE DELETED:</h6>
                        <ul>
                            <li><strong>{{ invoice_applications_count }}</strong> Invoice Application(s)</li>
                            <li><strong>{{ customer_applications_count }}</strong> Customer Application(s)</li>
                            <li><strong>{{ payments_count }}</strong> Payment(s)</li>
                        </ul>

                        <hr>
                        <p class="mb-0"><strong>This action cannot be undone!</strong></p>
                    </div>

                    <form method="post" class="mt-3" onsubmit="return confirm('Are you ABSOLUTELY SURE you want to force delete this invoice and all related data? This action is PERMANENT and cannot be undone!')">
                        {% csrf_token %}

                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" name="force_delete_confirmed" value="yes" id="force_delete_confirmed" required>
                            <label class="form-check-label text-danger" for="force_delete_confirmed">
                                <strong>I understand this will permanently delete the invoice and all related customer applications and payments</strong>
                            </label>
                        </div>

                        <div>
                            <button type="submit" class="btn btn-danger">
                                <i class="bi bi-trash"></i> Force Delete Invoice
                            </button>
                            <a href="{% url 'invoice-list' %}" class="btn btn-outline-primary">
                                <i class="bi bi-x-circle"></i> Cancel
                            </a>
                        </div>
                    </form>
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
