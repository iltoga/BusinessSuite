@if (isLoading()) {
  <div class="space-y-6">
    <!-- Header Skeleton -->
    <div class="flex flex-wrap items-center justify-between gap-4">
      <div class="space-y-2">
        <z-skeleton class="h-8 w-64" />
        <z-skeleton class="h-4 w-48" />
      </div>
      <div class="flex gap-2">
        <z-skeleton class="h-10 w-24" />
        <z-skeleton class="h-10 w-24" />
        <z-skeleton class="h-10 w-24" />
      </div>
    </div>

    <!-- Info Cards Skeletons -->
    <app-card-skeleton [lines]="5" />
    <app-card-skeleton [lines]="8" />
    <app-card-skeleton [lines]="4" />

    <!-- Applications List Skeleton -->
    <z-card class="p-6">
      <div class="mb-4">
        <z-skeleton class="h-6 w-1/4" />
      </div>
      <app-table-skeleton [rows]="5" [columns]="6" />
    </z-card>
  </div>
} @else if (!customer()) {
  <div class="text-muted-foreground">Customer not found.</div>
} @else {
  <div class="space-y-6">
    <!-- Header -->
    <div class="flex flex-wrap items-center justify-between gap-4">
      <div>
        <h1 class="text-2xl font-semibold">Customer ID #{{ customer()!.id }}</h1>
        <p class="text-sm text-muted-foreground">Customer detail</p>
      </div>
      <div class="flex flex-wrap gap-2">
        <a z-button zType="outline" routerLink="/customers/{{ customer()!.id }}/edit">Edit</a>
        @if (isSuperuser()) {
          <button z-button zType="destructive" (click)="onDelete()">Delete</button>
        }
        <a
          z-button
          zType="ghost"
          [routerLink]="'/customers'"
          [state]="{ focusTable: true, focusId: customer()!.id, searchQuery: originSearchQuery() }"
          >Back to list</a
        >
      </div>
    </div>

    <!-- Identity Section -->
    <z-card class="p-6">
      <div class="mb-4">
        <h3 class="text-lg font-semibold mb-3 border-b pb-2">Identity</h3>
        <div class="text-xl mb-2">
          @if (customer()!.title) {
            {{ customer()!.title }}.
          }
          @if (customer()!.firstName || customer()!.lastName) {
            {{ customer()!.firstName }} {{ customer()!.lastName }}
          } @else {
            {{ customer()!.fullName }}
          }
        </div>
        @if (customer()!.customerType === 'company' && customer()!.companyName) {
          <div class="text-sm text-muted-foreground mb-3">
            Company: {{ customer()!.companyName }}
          </div>
        }
        <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <dt class="text-sm font-medium text-muted-foreground">Customer Type</dt>
            <dd class="text-sm">{{ customer()!.customerType | titlecase }}</dd>
          </div>
          @if (customer()!.nationality) {
            <div>
              <dt class="text-sm font-medium text-muted-foreground">Nationality</dt>
              <dd class="text-sm">{{ customer()!.nationality }}</dd>
            </div>
          }
          @if (customer()!.birthPlace) {
            <div>
              <dt class="text-sm font-medium text-muted-foreground">Birth Place</dt>
              <dd class="text-sm">{{ customer()!.birthPlace }}</dd>
            </div>
          }
          @if (customer()!.birthdate) {
            <div>
              <dt class="text-sm font-medium text-muted-foreground">Birthdate</dt>
              <dd class="text-sm">{{ customer()!.birthdate | appDate }}</dd>
            </div>
          }
        </dl>
      </div>
    </z-card>

    <!-- Contact & Payment Section -->
    <z-card class="p-6">
      <div class="mb-4">
        <h3 class="text-lg font-semibold mb-3 border-b pb-2">Contact & Payment</h3>
        <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <dt class="text-sm font-medium text-muted-foreground">Email</dt>
            <dd class="text-sm">{{ customer()!.email || '—' }}</dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-muted-foreground">Telephone</dt>
            <dd class="text-sm">{{ customer()!.telephone || '—' }}</dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-muted-foreground">Whatsapp</dt>
            <dd class="text-sm">{{ customer()!.whatsapp || '—' }}</dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-muted-foreground">Telegram</dt>
            <dd class="text-sm">{{ customer()!.telegram || '—' }}</dd>
          </div>
          @if (customer()!.npwp) {
            <div>
              <dt class="text-sm font-medium text-muted-foreground">NPWP</dt>
              <dd class="text-sm">{{ customer()!.npwp }}</dd>
            </div>
          }
        </dl>
      </div>

      <!-- Address Section -->
      <div class="mb-4">
        <h4 class="text-md font-semibold mb-3 border-b pb-2">Address</h4>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <strong class="text-sm font-medium">Address in Bali</strong>
            <div class="text-sm text-muted-foreground">{{ customer()!.addressBali || '—' }}</div>
          </div>
          <div>
            <strong class="text-sm font-medium">Address Abroad</strong>
            <div class="text-sm text-muted-foreground">{{ customer()!.addressAbroad || '—' }}</div>
          </div>
        </div>
      </div>

      <!-- Notifications Section -->
      <div>
        <h4 class="text-md font-semibold mb-3 border-b pb-2">Notifications</h4>
        <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <dt class="text-sm font-medium text-muted-foreground">Notify Expiration</dt>
            <dd class="text-sm">{{ customer()!.notifyDocumentsExpiration ? 'Yes' : 'No' }}</dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-muted-foreground">Notify By</dt>
            <dd class="text-sm">{{ customer()!.notifyBy || '—' }}</dd>
          </div>
        </dl>
      </div>
    </z-card>

    <!-- Passport Details Section -->
    <z-card class="p-6">
      <h3 class="text-lg font-semibold mb-4 border-b pb-2">Passport Details</h3>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Passport Image -->
        <div>
          @if (customer()!.passportFile) {
            <a href="{{ customer()!.passportFile }}" target="_blank" rel="noopener noreferrer">
              <img
                src="{{ customer()!.passportFile }}"
                alt="Passport Image"
                class="w-full max-w-sm h-auto rounded-lg shadow-sm border"
              />
            </a>
            <div class="text-xs text-muted-foreground mt-2">
              File:
              <a
                href="{{ customer()!.passportFile }}"
                target="_blank"
                rel="noopener noreferrer"
                class="text-primary hover:underline"
                >{{ customer()!.passportFile | slice: -40 }}</a
              >
            </div>
          } @else {
            <div class="text-muted-foreground text-sm">No passport file uploaded.</div>
          }
        </div>

        <!-- Passport Information -->
        <div>
          <table class="w-full">
            <tbody>
              @if (customer()!.passportNumber) {
                <tr>
                  <th scope="row" class="text-left py-2 text-sm font-medium">Passport Number</th>
                  <td class="text-left py-2 text-sm">{{ customer()!.passportNumber }}</td>
                </tr>
              }
              @if (customer()!.passportIssueDate) {
                <tr>
                  <th scope="row" class="text-left py-2 text-sm font-medium">
                    Passport Issue Date
                  </th>
                  <td class="text-left py-2 text-sm">
                    {{ customer()!.passportIssueDate | appDate }}
                  </td>
                </tr>
              }
              @if (customer()!.passportExpirationDate) {
                <tr>
                  <th scope="row" class="text-left py-2 text-sm font-medium">
                    Passport Expiration Date
                  </th>
                  <td class="text-left py-2 text-sm">
                    {{ customer()!.passportExpirationDate | appDate }}
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </z-card>

    <!-- Uninvoiced Applications Section -->
    <z-card class="p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold border-b pb-2">Uninvoiced Applications</h3>
        <span class="text-sm text-muted-foreground">Coming soon</span>
      </div>

      @if (uninvoicedApplications().length > 0) {
        <div class="overflow-x-auto">
          <table class="w-full border-collapse">
            <thead>
              <tr class="border-b">
                <th class="text-left py-3 px-4 text-sm font-medium text-muted-foreground">#ID</th>
                <th class="text-left py-3 px-4 text-sm font-medium text-muted-foreground">
                  Product
                </th>
                <th class="text-left py-3 px-4 text-sm font-medium text-muted-foreground">Type</th>
                <th class="text-left py-3 px-4 text-sm font-medium text-muted-foreground">
                  Doc Date
                </th>
                <th class="text-left py-3 px-4 text-sm font-medium text-muted-foreground">
                  Status
                </th>
                <th class="text-left py-3 px-4 text-sm font-medium text-muted-foreground">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody>
              @for (app of uninvoicedApplications(); track app.id) {
                <tr class="border-b hover:bg-muted/50">
                  <td class="py-3 px-4 text-sm">
                    <span class="text-primary font-medium">{{ app.id }}</span>
                  </td>
                  <td class="py-3 px-4 text-sm">
                    <span class="text-primary">{{ app.product.name }}</span>
                  </td>
                  <td class="py-3 px-4 text-sm">{{ app.product.product_type | titlecase }}</td>
                  <td class="py-3 px-4 text-sm">{{ app.doc_date | appDate }}</td>
                  <td class="py-3 px-4 text-sm">
                    <z-badge [zType]="getStatusBadgeType(app.status)">{{
                      app.status | titlecase
                    }}</z-badge>
                  </td>
                  <td class="py-3 px-4 text-sm">
                    <a z-button zType="outline" zSize="sm" [routerLink]="['/applications', app.id]">
                      View
                    </a>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      } @else {
        <div class="text-muted-foreground text-sm">No uninvoiced applications found.</div>
      }
    </z-card>
  </div>
}
