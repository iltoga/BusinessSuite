<div class="h-full flex flex-col gap-6">
  <div class="flex flex-wrap items-center justify-between gap-3">
    <h1 class="text-3xl font-bold tracking-tight">Products</h1>
    <a routerLink="/products/new">
      <z-button zType="default" zSize="default">New Product</z-button>
    </a>
  </div>

  <div class="bg-card rounded-lg border shadow-sm">
    <div class="p-4 border-b">
      <app-search-toolbar
        [query]="query()"
        [placeholder]="'Search products...'"
        (queryChange)="onQueryChange($event)"
      />
    </div>

    <div class="p-0">
      <app-data-table
        [columns]="columns()"
        [data]="products()"
        [isLoading]="isLoading()"
        (sortChange)="onSortChange($event)"
      />
    </div>

    <div class="p-4 border-t bg-muted/20">
      <app-pagination-controls
        [page]="page()"
        [totalPages]="totalPages()"
        (pageChange)="onPageChange($event)"
      />
    </div>
  </div>
</div>

<ng-template #nameTemplate let-row>
  <a [routerLink]="['/products', row.id]" class="font-medium hover:underline">
    {{ row.name }}
  </a>
</ng-template>

<ng-template #descriptionTemplate let-row>
  <div
    class="text-sm text-muted-foreground"
    style="
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    "
    [attr.title]="row.description || ''"
  >
    {{ row.description }}
  </div>
</ng-template>

<ng-template #typeTemplate let-row>
  <z-badge zType="secondary">{{ productTypeLabel(row.productType) }}</z-badge>
</ng-template>

<ng-template #priceTemplate let-row>
  <span>{{ formatCurrency(row.basePrice) }}</span>
</ng-template>

<ng-template #actionsTemplate let-row>
  <div class="flex items-center gap-2 flex-nowrap whitespace-nowrap">
    <a [routerLink]="['/products', row.id]">
      <z-button zType="default" zSize="sm">View</z-button>
    </a>
    <a [routerLink]="['/products', row.id, 'edit']">
      <z-button zType="warning" zSize="sm">Edit</z-button>
    </a>
    <z-button zType="destructive" zSize="sm" (click)="requestDelete(row)"> Delete </z-button>
  </div>
</ng-template>

<app-confirm-dialog
  [isOpen]="confirmOpen()"
  [title]="'Delete product'"
  [message]="confirmMessage()"
  [destructive]="true"
  confirmText="Delete"
  cancelText="Cancel"
  (confirmed)="confirmDelete()"
  (cancelled)="cancelDelete()"
/>
