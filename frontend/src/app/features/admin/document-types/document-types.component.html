<div class="space-y-6">
  <div class="flex flex-wrap items-start justify-between gap-3">
    <h1 class="text-2xl font-bold tracking-tight">Document Types</h1>
    <button z-button class="w-full sm:w-auto" (click)="createNew()" [zDisabled]="isDialogOpen()">
      Add Document Type
    </button>
  </div>

  <!-- Edit/Create Modal Template -->
  <ng-template #documentTypeModalTemplate>
    <form [formGroup]="documentTypeForm" (ngSubmit)="saveDocumentType()" class="space-y-4 py-4">
      <div class="space-y-4">
        <div></div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="space-y-2">
            <label class="text-sm font-medium" for="name">Name *</label>
            <input
              z-input
              id="name"
              formControlName="name"
              placeholder="Enter document type name"
              [zStatus]="
                documentTypeForm.get('name')?.invalid && documentTypeForm.get('name')?.touched
                  ? 'error'
                  : undefined
              "
            />
            @if (documentTypeForm.get('name')?.invalid && documentTypeForm.get('name')?.touched) {
              <p class="text-sm text-destructive">Document type name is required</p>
            }
          </div>

          <div class="space-y-2">
            <label class="text-sm font-medium" for="validationRuleRegex"
              >Validation Rule Regex</label
            >
            <input
              z-input
              id="validationRuleRegex"
              formControlName="validationRuleRegex"
              placeholder="Enter regex pattern"
            />
          </div>
        </div>

        <div class="space-y-2">
          <label class="text-sm font-medium" for="description">Description</label>
          <textarea
            z-input
            id="description"
            formControlName="description"
            placeholder="Enter description"
            rows="3"
          ></textarea>
        </div>

        @if (documentTypeForm.get('aiValidation')?.value) {
          <div class="space-y-2">
            <label class="text-sm font-medium" for="validationRuleAiPositive"
              >AI Validation Rule (Positive)</label
            >
            <textarea
              z-input
              id="validationRuleAiPositive"
              formControlName="validationRuleAiPositive"
              placeholder="Describe what a valid document should contain"
              rows="4"
            ></textarea>
          </div>

          <div class="space-y-2">
            <label class="text-sm font-medium" for="validationRuleAiNegative"
              >AI Validation Rule (Negative)</label
            >
            <textarea
              z-input
              id="validationRuleAiNegative"
              formControlName="validationRuleAiNegative"
              placeholder="Describe issues that should invalidate the document"
              rows="4"
            ></textarea>
          </div>
        }

        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox" formControlName="aiValidation" class="rounded" />
            <span class="text-sm">AI Validation</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox" formControlName="deprecated" class="rounded" />
            <span class="text-sm">Deprecated</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox" formControlName="hasExpirationDate" class="rounded" />
            <span class="text-sm">Has Expiration Date</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox" formControlName="hasDocNumber" class="rounded" />
            <span class="text-sm">Has Document Number</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox" formControlName="hasFile" class="rounded" />
            <span class="text-sm">Has File</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox" formControlName="hasDetails" class="rounded" />
            <span class="text-sm">Has Details</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox" formControlName="isInRequiredDocuments" class="rounded" />
            <span class="text-sm">In Required Documents</span>
          </label>
        </div>

        <div class="mt-6 flex gap-2 justify-end">
          <button z-button type="button" variant="ghost" (click)="closeForm()">Cancel</button>
          <button
            z-button
            type="submit"
            [zDisabled]="documentTypeForm.invalid || isSaving()"
            [zLoading]="isSaving()"
          >
            {{ editingDocumentType() ? 'Update' : 'Create' }}
          </button>
        </div>
      </div>
    </form>
  </ng-template>

  <!-- Table -->
  <z-card class="p-0">
    <div class="border-b p-3 sm:p-4">
      <app-search-toolbar
        [query]="query()"
        [placeholder]="'Search Document Types...'"
        [isLoading]="isLoading()"
        (queryChange)="onQueryChange($event)"
        (tabOut)="onEnterSearch()"
      >
        <label class="flex items-center gap-2 text-sm text-muted-foreground">
          <input
            type="checkbox"
            class="rounded"
            [checked]="includeDeprecated()"
            (change)="onToggleIncludeDeprecated($any($event.target).checked)"
          />
          Include deprecated
        </label>
      </app-search-toolbar>
    </div>
    <app-data-table
      #dataTable
      [data]="documentTypes()"
      [columns]="columns"
      [actions]="actions"
      [isLoading]="isLoading()"
    />
  </z-card>

  <!-- Confirm Delete Dialog -->
  <app-confirm-dialog
    [isOpen]="showConfirmDelete()"
    title="Delete Document Type"
    [message]="confirmDeleteMessage()"
    [destructive]="true"
    (confirmed)="confirmDelete()"
    (cancelled)="showConfirmDelete.set(false)"
  />

  <app-confirm-dialog
    [isOpen]="showDeprecationConfirm()"
    title="Confirm product deprecation"
    [message]="deprecationConfirmMessage()"
    [destructive]="true"
    confirmText="Deprecate all"
    cancelText="Cancel"
    (confirmed)="confirmDeprecationCascade()"
    (cancelled)="cancelDeprecationCascade()"
  />
</div>
