<div class="space-y-3">
  <div
    [class]="getDropzoneClasses()"
    (click)="onBrowseClick()"
    (drop)="onDrop($event)"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
  >
    <input
      #fileInput
      type="file"
      class="hidden"
      [accept]="accept()"
      [disabled]="disabled()"
      (change)="onFileChange($event)"
    />
    <div class="text-sm font-medium">{{ label() }}</div>
    <div class="text-xs text-muted-foreground">Drag and drop here, or click to browse</div>
    @if (helperText()) {
      <div class="text-xs text-muted-foreground">{{ helperText() }}</div>
    }
  </div>

  @if (fileName()) {
    <div class="flex items-center justify-between rounded-md border bg-muted/30 px-3 py-2 text-sm">
      <span class="truncate">{{ fileName() }}</span>
      <button type="button" z-button zType="ghost" zSize="sm" (click)="clearSelection()">
        Clear
      </button>
    </div>
  }

  @if (showPreviewContainer()) {
    <div class="rounded-md border bg-muted/10 p-3">
      <div class="text-xs font-medium text-muted-foreground mb-2">Preview</div>
      <div class="relative h-160 overflow-hidden rounded-md bg-muted/20 mt-2 mb-2">
        @if (showPreviewSkeleton()) {
          <div class="absolute inset-0 animate-pulse p-4">
            <div class="h-full w-full rounded-md bg-muted/60"></div>
          </div>
        }
        <div class="flex h-full items-center justify-center">
          @if (showPreview()) {
            @if (previewType() === 'image') {
              <app-image-magnifier
                [src]="previewUrl()"
                alt="Selected file preview"
                [imageClass]="'max-h-140 w-auto max-w-full object-contain p-2'"
                [wrapperClass]="'max-w-full'"
                [enabledByDefault]="magnifierEnabledByDefault()"
                [showToggle]="showMagnifierToggle()"
                [toggleClass]="'h-9 w-9 bg-background/90 border border-border shadow-sm'"
              />
            } @else if (previewType() === 'pdf') {
              <iframe [src]="sanitizedPreview()" class="h-140 w-full border-0"></iframe>
            }
          } @else if (!previewLoading()) {
            <div class="px-3 text-xs text-muted-foreground">Preview not available.</div>
          }
        </div>
      </div>
    </div>
  }

  @if (progress() !== null) {
    <div class="space-y-1">
      <div class="flex items-center justify-between text-xs text-muted-foreground">
        <span>Upload progress</span>
        <span>{{ progress() }}%</span>
      </div>
      <div class="h-2 w-full rounded-full bg-muted">
        <div class="h-2 rounded-full bg-primary" [style.width.%]="progress()"></div>
      </div>
    </div>
  }
</div>
