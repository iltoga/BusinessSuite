{% load crispy_forms_tags %}
{% load static %}

<!-- Customer Application Quick Create Modal -->
<div class="modal fade" id="customerApplicationQuickCreateModal" tabindex="-1" aria-labelledby="customerApplicationQuickCreateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="customerApplicationQuickCreateModalLabel">
                    <i class="fas fa-file-alt"></i> Create Customer Application
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="customerApplicationQuickCreateForm" data-url="{% url 'api-customer-application-quick-create' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Create a new customer application for <strong id="customer-name-display"></strong>.
                    </div>
                    <div id="customerApplicationQuickCreateErrors" class="alert alert-danger d-none"></div>

                    <input type="hidden" id="id_quick_app_customer" name="customer" value="">

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="id_quick_app_product" class="form-label">Product <span class="text-danger">*</span></label>
                            <div class="product-field-wrapper">
                                <select class="form-select" id="id_quick_app_product" name="product" required>
                                    <option value="">---------</option>
                                </select>
                                <button type="button" class="btn btn-outline-success btn-add-product-from-app" title="Create new product">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <!-- DEBUG: Products count = {{ products|length }} -->
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="id_quick_app_doc_date" class="form-label">Application Date <span class="text-danger">*</span></label>
                            <input type="date" class="form-control" id="id_quick_app_doc_date" name="doc_date" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="id_quick_app_notes" class="form-label">Notes</label>
                        <textarea class="form-control" id="id_quick_app_notes" name="notes" rows="3" placeholder="Person-specific details (names, IDs, etc.)"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="submit" class="btn btn-info" id="customerApplicationQuickCreateSubmitBtn">
                        <i class="fas fa-save"></i> Create Application
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    #customerApplicationQuickCreateModal {
        z-index: 1060;
    }

    #customerApplicationQuickCreateModal .modal-backdrop {
        z-index: 1059;
    }

    #customerApplicationQuickCreateModal .product-field-wrapper {
        display: flex;
        gap: 8px;
        align-items: center;
    }

    #customerApplicationQuickCreateModal .product-field-wrapper .form-select {
        flex: 1;
    }

    #customerApplicationQuickCreateModal .product-field-wrapper .btn-add-product-from-app {
        flex-shrink: 0;
        width: 38px;
        height: 38px;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
    }
</style>

<script src="{% static 'js/utils.js' %}"></script>
<script src="{% static 'js/modals/customer_application_quick_create.js' %}"></script>
